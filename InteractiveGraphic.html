<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Unity Catalog Security Analogy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .modal-content {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-white rounded-xl shadow-2xl p-8">
        <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-2">The Unity Catalog Security Model</h1>
        <p class="text-center text-gray-500 mb-8">Drawing parallel between Modern Office work place and Data governance in Databricks</p>

        <!-- Layer 1: The Corporate Campus -->
        <div class="bg-gray-50 border-2 border-gray-200 rounded-lg p-6 m-2">
            <div class="flex items-center mb-2">
                <div class="text-3xl mr-4">üè¢</div>
                <div>
                    <h2 class="font-bold text-xl text-gray-700">1. The Corporate Campus</h2>
                    <p class="text-sm font-semibold text-blue-600">Equivalent: The Azure Account</p>
                </div>
            </div>
            <p class="text-gray-600 ml-12">You must be a registered employee or invited guest to enter the main gate. If you're not on the master list, you can't get on the property.</p>
            <button class="explain-btn mt-4 ml-12 bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-1 px-3 rounded-full transition-colors duration-300">‚ú® Explain this Layer</button>

            <!-- Layer 2: The Office Building -->
            <div class="bg-white border-2 border-gray-300 rounded-lg p-6 mt-4 ml-6">
                <div class="flex items-center mb-2">
                    <div class="text-3xl mr-4">üè¨</div>
                    <div>
                        <h2 class="font-bold text-lg text-gray-700">2. The Office Building</h2>
                        <p class="text-sm font-semibold text-blue-600">Equivalent: The Databricks Workspace</p>
                    </div>
                </div>
                <p class="text-gray-600 ml-12">Your badge must be specifically activated for this building. Being on campus isn't enough to get through the front door.</p>
                <button class="explain-btn mt-4 ml-12 bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-1 px-3 rounded-full transition-colors duration-300">‚ú® Explain this Layer</button>

                <!-- Layer 3: The Floor Access -->
                <div class="bg-gray-50 border-2 border-gray-400 rounded-lg p-6 mt-4 ml-6">
                    <div class="flex items-center mb-2">
                        <div class="text-3xl mr-4">üö™</div>
                        <div>
                            <h2 class="font-bold text-md text-gray-700">3. The Floor Access</h2>
                            <p class="text-sm font-semibold text-blue-600">Equivalent: The Schema (USE SCHEMA)</p>
                        </div>
                    </div>
                    <p class="text-gray-600 ml-12">Your keycard needs another layer of permission to unlock the elevator to the secure 5th floor.</p>
                    <button class="explain-btn mt-4 ml-12 bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-1 px-3 rounded-full transition-colors duration-300">‚ú® Explain this Layer</button>

                    <!-- Layer 4: The Network Port -->
                    <div class="bg-white border-2 border-gray-500 rounded-lg p-6 mt-4 ml-6">
                        <div class="flex items-center mb-2">
                            <div class="text-3xl mr-4">üîå</div>
                            <div>
                                <h2 class="font-bold text-base text-gray-700">4. The Network Port</h2>
                                <p class="text-sm font-semibold text-blue-600">Equivalent: The Table (SELECT)</p>
                            </div>
                        </div>
                        <p class="text-gray-600 ml-12">Being at your desk isn't enough. The network port won't activate unless security has granted your profile access to that specific data stream.</p>
                        <button class="explain-btn mt-4 ml-12 bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-1 px-3 rounded-full transition-colors duration-300">‚ú® Explain this Layer</button>

                        <!-- Layer 5: The Application Firewall -->
                        <div class="bg-gray-50 border-2 border-gray-700 rounded-lg p-6 mt-4 ml-6">
                            <div class="flex items-center mb-2">
                                <div class="text-3xl mr-4">üõ°Ô∏è</div>
                                <div>
                                    <h2 class="font-bold text-sm text-gray-800">5. The Application Firewall</h2>
                                    <p class="text-xs font-semibold text-blue-600">Equivalent: Column/Row Level Security</p>
                                </div>
                            </div>
                            <p class="text-gray-700 ml-12">You're on the network, but the firewall blocks you from sensitive applications. You can't see the salary column or data from other departments.</p>
                            <button class="explain-btn mt-4 ml-12 bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-1 px-3 rounded-full transition-colors duration-300">‚ú® Explain this Layer</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="explanation-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4">
        <div class="modal-content bg-white rounded-lg shadow-xl p-8 max-w-2xl w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-2xl font-bold text-gray-800"></h3>
                <button id="close-modal" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="modal-body" class="text-gray-700 space-y-4">
                <div id="loading-spinner" class="flex justify-center items-center h-32">
                    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500"></div>
                </div>
                <p id="explanation-text"></p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const explainButtons = document.querySelectorAll('.explain-btn');
            const modal = document.getElementById('explanation-modal');
            const closeModalBtn = document.getElementById('close-modal');
            const modalTitle = document.getElementById('modal-title');
            const explanationText = document.getElementById('explanation-text');
            const loadingSpinner = document.getElementById('loading-spinner');

            const getLayerInfo = (button) => {
                const parentDiv = button.closest('div');
                const title = parentDiv.querySelector('h2').innerText;
                const equivalent = parentDiv.querySelector('p[class*="text-blue-600"]').innerText;
                const description = parentDiv.querySelector('p[class*="text-gray-"]').innerText;
                return { title, equivalent, description };
            };
            
            const callGeminiAPI = async (prompt, retries = 3, delay = 1000) => {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                           throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            return result.candidates[0].content.parts[0].text;
                        } else {
                           throw new Error("Invalid response structure from API");
                        }
                    } catch (error) {
                        if (i === retries - 1) {
                           return "Sorry, I couldn't get an explanation at this time. Please try again later.";
                        }
                        await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                    }
                }
            };

            explainButtons.forEach(button => {
                button.addEventListener('click', async () => {
                    const { title, equivalent, description } = getLayerInfo(button);
                    
                    modalTitle.innerText = title;
                    explanationText.innerHTML = '';
                    loadingSpinner.style.display = 'flex';
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                    
                    const prompt = `You are an expert data architect. Explain the following data governance concept in simple, clear terms for a business professional, using the provided analogy. Be concise and focus on the business impact.
                    
                    Analogy: "${title}"
                    Technical Equivalent: "${equivalent}"
                    Description: "${description}"
                    
                    Start your explanation directly without any preamble.`;

                    const explanation = await callGeminiAPI(prompt);
                    explanationText.innerHTML = explanation.replace(/\n/g, '<br>');
                    loadingSpinner.style.display = 'none';
                });
            });

            const closeModal = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            };

            closeModalBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>
